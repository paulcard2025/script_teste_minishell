#!/bin/bash
# ============================================================
# TESTE AUTOMATIZADO DO LEXER (TRATAMENTO DE QUOTES)
# Projeto: Minishell (42)
# Autor: paulcard
# DescriÃ§Ã£o:
#   Este script compara o comportamento do minishell com o bash
#   para vÃ¡rios casos envolvendo aspas simples e duplas.
# ============================================================

# Caminho para o executÃ¡vel do minishell
MINISHELL=./minishell

# Cores para realce
GREEN="\033[1;32m"
RED="\033[1;31m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
NC="\033[0m" # sem cor

# Verifica se o binÃ¡rio existe
if [ ! -x "$MINISHELL" ]; then
    echo -e "${RED}âŒ Erro:${NC} executÃ¡vel '$MINISHELL' nÃ£o encontrado."
    echo -e "Execute ${YELLOW}'make'${NC} antes de rodar este teste."
    exit 1
fi

# FunÃ§Ã£o para alinhar colunas
pad_text() {
    local text="$1"
    printf "%-40s" "$text"
}

# FunÃ§Ã£o de teste e comparaÃ§Ã£o
run_test() {
    local input="$1"

    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "ğŸ”¹ ${YELLOW}Input:${NC} $input"
    echo -e "${CYAN}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"

    # --- Bash ---
    bash_output=$(bash -c "$input" 2>&1)

    # --- Minishell ---
    # Filtra linhas do prompt para comparaÃ§Ã£o
    mini_output=$(echo "$input" | $MINISHELL 2>&1 | grep -v 'paulcard@minishell')

    # Exibe saÃ­das em paralelo
    echo -e "${GREEN}ğŸš Bash output:${NC}"
    echo -e "$bash_output"
    echo ""
    echo -e "${YELLOW}ğŸš€ Minishell output:${NC}"
    echo -e "$mini_output"
    echo ""

    # --- ComparaÃ§Ã£o ---
    if [ "$bash_output" = "$mini_output" ]; then
        echo -e "${GREEN}âœ… Resultado idÃªntico ao bash${NC}"
    else
        echo -e "${RED}âš ï¸  DiferenÃ§a detectada!${NC}"
        echo ""
        echo -e "${YELLOW}ğŸ” DiferenÃ§a detalhada:${NC}"
        diff <(echo "$bash_output") <(echo "$mini_output") || true
    fi

    echo ""
}

# ============================================================
# LISTA DE TESTES
# ============================================================

echo ""
echo -e "${CYAN}=== ğŸ§ª TESTES DE QUOTES - LEXER (MINISHELL) ===${NC}"
echo ""

run_test 'echo """hello world"""'
run_test 'echo ""hello world""'
run_test 'echo "hello"" world"'
run_test 'echo "" "hello" ""'
run_test 'echo "hello"world'
run_test "echo 'a''b''c'"
run_test "echo 'hello world'"
run_test 'echo "test | pipe"'
run_test "echo 'test && and'"
run_test 'echo "hello"'"'"'world'"'"'test'
run_test 'cat file1 "file 2" '"'"'file 3'"'"
run_test 'echo "hello'
run_test "echo \"\""
run_test "echo ''"

echo ""
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${GREEN}âœ… Fim dos testes de quotes${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
